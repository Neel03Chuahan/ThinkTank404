<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThinkTank 404 | AI Meeting Workspace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Library for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen font-sans">
    
    <!-- Navbar -->
    <nav class="bg-slate-800/50 backdrop-blur-md border-b border-slate-700 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded-lg">
                    <i class="fa-solid fa-brain text-white text-xl"></i>
                </div>
                <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">ThinkTank 404</h1>
            </div>
            
            <button onclick="window.location.reload()" class="text-slate-400 hover:text-white transition-colors">
                <i class="fa-solid fa-rotate-right"></i> Reset
            </button>
        </div>
    </nav>

    <div class="max-w-5xl mx-auto px-4 py-10">
        
        <!-- Upload Section -->
        <div id="uploadSection" class="mb-12 transition-all duration-500">
            <div class="text-center mb-10">
                <h2 class="text-4xl font-extrabold mb-4">Turn Chaos into Clarity</h2>
                <p class="text-slate-400 text-lg">Upload your meeting audio. We'll extract the tasks, tone, and timeline.</p>
            </div>

            <div class="bg-slate-800 p-8 rounded-2xl border-2 border-dashed border-slate-600 hover:border-blue-500 transition-all group cursor-pointer relative overflow-hidden" onclick="document.getElementById('audioFile').click()">
                <input type="file" id="audioFile" accept=".wav,.flac,.mp3,.ogg,.m3u,.aac,.wma,.midi,.aif,.m4a,.mpa,.pls,.mp4" class="hidden" onchange="handleFileSelect(this)">
                
                <div class="flex flex-col items-center justify-center relative z-10">
                    <div class="bg-slate-700 group-hover:bg-blue-600/20 group-hover:text-blue-400 transition-all p-6 rounded-full mb-4">
                        <i class="fa-solid fa-cloud-arrow-up text-4xl"></i>
                    </div>
                    <p class="text-xl font-semibold mb-2" id="fileNameDisplay">Click to upload Audio</p>
                    <p class="text-slate-500 text-sm">Supports WAV, MP3, FLAC, M4A & more</p>
                </div>
            </div>

            <button onclick="summarizeMeeting()" id="btnAction" class="w-full mt-6 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/20 transition-all transform active:scale-[0.99] disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fa-solid fa-wand-magic-sparkles mr-2"></i> Generate Smart Summary
            </button>
        </div>

<!-- Loading -->
        <div id="loading" class="hidden py-20 text-center">
            <div class="inline-block relative">
                <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <i class="fa-solid fa-robot text-blue-400 text-sm"></i>
                </div>
            </div>
            <h3 class="mt-6 text-xl font-semibold text-blue-300 animate-pulse">AI is analyzing speaker tone & urgency...</h3>
            <p class="text-slate-500 mt-2">Transcribing with Whisper â€¢ Thinking with Llama 3</p>
        </div>

        <div id="results" class="hidden space-y-8 animate-fade-in-up">
            
<!-- Toolbar -->
            <div class="flex justify-between items-center bg-slate-800/80 p-4 rounded-xl border border-slate-700 backdrop-blur-sm">
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                    <span class="text-sm font-medium text-green-400">Analysis Complete</span>
                </div>
                <button onclick="exportToPDF()" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors border border-slate-600">
                    <i class="fa-solid fa-file-pdf mr-2 text-red-400"></i> Export Report
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
<!-- Urgency Score -->
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <i class="fa-solid fa-fire text-6xl"></i>
                    </div>
                    <p class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-1">Urgency Score</p>
                    <div class="flex items-end gap-2">
                        <span id="urgencyScore" class="text-4xl font-black text-white">0</span>
                        <span class="text-lg text-slate-500 mb-1">/ 100</span>
                    </div>
                    <div class="w-full bg-slate-700 h-2 rounded-full mt-4 overflow-hidden">
                        <div id="urgencyBar" class="h-full bg-gradient-to-r from-orange-500 to-red-500 w-0 transition-all duration-1000"></div>
                    </div>
                </div>

<!--Analysis Tone-->
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                    <p class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-3">Detected Tone</p>
                    <div class="flex items-start gap-3">
                        <div class="bg-purple-500/20 p-2 rounded-lg text-purple-400">
                            <i class="fa-solid fa-masks-theater text-xl"></i>
                        </div>
                        <p id="toneText" class="text-lg font-medium leading-tight">Neutral</p>
                    </div>
                </div>

<!-- Scheduling -->
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                    <p class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-3">Smart Schedule</p>
                    <div class="flex items-start gap-3">
                        <div class="bg-blue-500/20 p-2 rounded-lg text-blue-400">
                            <i class="fa-regular fa-calendar-check text-xl"></i>
                        </div>
                        <p id="scheduleText" class="text-lg font-medium leading-tight">--</p>
                    </div>
                </div>
            </div>

            <div id="reportContent">
<!--Layout -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
<!-- Summary -->
                    <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 shadow-xl group h-fit">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-2xl font-bold text-blue-400">Executive Summary</h3>
                            <span class="text-xs text-slate-500 bg-slate-900 px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">
                                <i class="fa-solid fa-pen"></i> Click to edit
                            </span>
                        </div>
                        <div id="summaryText" contenteditable="true" class="text-slate-300 leading-relaxed text-lg outline-none focus:ring-2 focus:ring-blue-500/50 rounded p-2 border border-transparent focus:border-slate-600 transition-all hover:bg-slate-700/30">
                            Summary will appear here...
                        </div>
                    </div>

<!-- Items Checkboxes -->
                    <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 shadow-xl">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-emerald-400">Priority Items</h3>
                            <button onclick="addTask()" class="text-xs bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-1.5 rounded transition-colors">
                                <i class="fa-solid fa-plus"></i> Add Task
                            </button>
                        </div> 
                        <ul id="taskList" class="space-y-3">
<!-- Tasks edit -->
                        </ul>
                    </div>
                </div>
<!-- Task Distribution -->
                <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 shadow-xl">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-purple-400">Task Distribution</h3>
                        <span class="text-slate-400 text-sm">
                            <i class="fa-solid fa-users mr-2"></i>
                            <span id="totalTasks" class="font-bold text-white">0</span> Tasks Total
                        </span>
                    </div>
                    
                    <div id="taskDistribution" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
<!-- Distribution cards here -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
// File Selection
        function handleFileSelect(input) {
            const fileName = input.files[0] ? input.files[0].name : "Click to upload Audio";
            document.getElementById('fileNameDisplay').innerText = fileName;
        }

//Logic
        async function summarizeMeeting() {
            const fileInput = document.getElementById('audioFile');
            const btn = document.getElementById('btnAction');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const uploadSection = document.getElementById('uploadSection');

            if (!fileInput.files[0]) return alert("Please upload a file first!");
            btn.disabled = true;
            uploadSection.classList.add('opacity-50', 'pointer-events-none');
            loading.classList.remove('hidden');
            results.classList.add('hidden');

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
// Note: run 'python main.py'
                const response = await fetch('http://127.0.0.1:8000/summarize', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.detail || "Backend Error");
                }

                const data = await response.json();
                document.getElementById('summaryText').innerText = data.summary;
                const score = data.urgency_score || 0;
                document.getElementById('urgencyScore').innerText = score;
                document.getElementById('urgencyBar').style.width = score + "%";
                document.getElementById('toneText').innerText = data.tone_analysis;
                document.getElementById('scheduleText').innerText = data.suggested_schedule || "No explicit deadline";
                const taskList = document.getElementById('taskList');
                taskList.innerHTML = "";
                
                if (data.action_items) {
                    data.action_items.forEach(item => {
                        addTaskCard(item.task, item.owner, item.priority);
                    });
                }
                updateTaskDistribution();
//Results
                loading.classList.add('hidden');
                uploadSection.classList.add('hidden');
                results.classList.remove('hidden');
            } catch (error) {
                console.error("Full Error:", error);
                let msg = "Error: " + error.message;
                
                if (error.message.includes("Failed to fetch")) {
                    msg = "CONNECTION ERROR:\nCould not reach the backend.\n\n1. Make sure you ran 'python main.py' in the terminal.\n2. Keep that terminal window OPEN.\n3. Ensure it says 'Uvicorn running on http://127.0.0.1:8000'";
                }
                alert(msg);
                uploadSection.classList.remove('opacity-50', 'pointer-events-none');
                loading.classList.add('hidden');
                btn.disabled = false;
            }
        }
//New Task
        function addTaskCard(taskText = "New Task", owner = "Unassigned", priority = "Medium") {
            const list = document.getElementById('taskList');
            let priorityColor = "bg-blue-500/20 text-blue-400";
            if(priority === "High") priorityColor = "bg-red-500/20 text-red-400";
            if(priority === "Low") priorityColor = "bg-green-500/20 text-green-400";
            const li = document.createElement('li');
            li.className = 'bg-slate-700/40 p-4 rounded-lg border border-slate-600 group transition-all hover:bg-slate-700/60 flex items-start gap-3';
            li.innerHTML =`
            <input type="checkbox" onchange="toggleTaskComplete(this)" class="mt-1 w-5 h-5 rounded border-2 border-slate-500 bg-slate-800 checked:bg-emerald-500 checked:border-emerald-500 cursor-pointer focus:ring-2 focus:ring-emerald-500/50 transition-all">
            <div class="flex-1">
                <div class="task-text font-medium text-slate-100 outline-none focus:border-b focus:border-blue-400 mb-2" contenteditable="true">
                    ${taskText}
                    </div>
                    <div class="flex gap-2 text-xs flex-wrap">
                        <span class="text-slate-400 bg-slate-800 px-2 py-1 rounded flex items-center gap-1 hover:ring-2 hover:ring-blue-500/50 transition-all" title="Click to edit">
                            <i class="fa-solid fa-user"></i> 
                            <span contenteditable="true" class="owner-value outline-none focus:text-white" onblur="updateTaskDistribution()">${owner}</span>
                        </span>
                        <span onclick="cyclePriority(this)" class="${priorityColor} px-2 py-1 rounded font-semibold flex items-center gap-1 cursor-pointer hover:ring-2 hover:ring-slate-500 transition-all" title="Click to change priority">
                            <i class="fa-solid fa-flag"></i> 
                            <span class="priority-value">${priority}</span>
                        </span>
                    </div>
                </div>
                <button onclick="this.parentElement.remove(); updateTaskDistribution();" class="text-slate-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity p-2">
                    <i class="fa-solid fa-trash"></i>
                </button>
            `;
            list.appendChild(li);
            updateTaskDistribution();
        }
        function toggleTaskComplete(checkbox) {
            const taskText = checkbox.parentElement.querySelector('.task-text');
            if(checkbox.checked) {
                taskText.style.textDecoration = 'line-through';
                taskText.style.opacity = '0.5';
            } else {
                taskText.style.textDecoration = 'none';
                taskText.style.opacity = '1';
            }
        }
        function cyclePriority(priorityBadge) {
            const priorityValueSpan = priorityBadge.querySelector('.priority-value');
            const currentPriority = priorityValueSpan.innerText.trim();
// Priorities
            let newPriority;
            let newColorClass;
            
            if(currentPriority === 'High') {
                newPriority = 'Medium';
                newColorClass = 'bg-blue-500/20 text-blue-400';
            } else if(currentPriority === 'Medium') {
                newPriority = 'Low';
                newColorClass = 'bg-green-500/20 text-green-400';
            } else {
                newPriority = 'High';
                newColorClass = 'bg-red-500/20 text-red-400';
            }
            priorityValueSpan.innerText = newPriority;
            priorityBadge.classList.remove('bg-red-500/20', 'text-red-400', 'bg-blue-500/20', 'text-blue-400', 'bg-green-500/20', 'text-green-400');
            const colorClasses = newColorClass.split(' ');
            priorityBadge.classList.add(...colorClasses);
            updateTaskDistribution();
        }
        function updateTaskDistribution() {
            const taskList = document.getElementById('taskList');
            const distributionContainer = document.getElementById('taskDistribution');
            const totalTasksSpan = document.getElementById('totalTasks');
// Get all tasks
            const tasks = Array.from(taskList.querySelectorAll('li'));
            totalTasksSpan.innerText = tasks.length;
// Group by owner
            const tasksByOwner = {};
            tasks.forEach(task => {
                const ownerSpan = task.querySelector('.fa-user').parentElement.querySelector('span[contenteditable]');
                const taskTextDiv = task.querySelector('.task-text');
                const prioritySpan = task.querySelector('.fa-flag').parentElement; 
                const owner = ownerSpan ? ownerSpan.innerText.trim() : 'Unassigned';
                const taskText = taskTextDiv ? taskTextDiv.innerText.trim() : 'Unknown Task';
                const priority = prioritySpan ? prioritySpan.innerText.trim() : 'Medium';
                
                if(!tasksByOwner[owner]) {
                    tasksByOwner[owner] = [];
                }
                tasksByOwner[owner].push({ text: taskText, priority: priority });
            });
            distributionContainer.innerHTML = '';
            
            if(Object.keys(tasksByOwner).length === 0) {
                distributionContainer.innerHTML = '<p class="text-slate-400 col-span-full text-center py-8">No tasks assigned yet</p>';
                return;
            }
// Card for each owner
            Object.keys(tasksByOwner).forEach(owner => {
                const ownerTasks = tasksByOwner[owner];
                const taskCount = ownerTasks.length;
                const highCount = ownerTasks.filter(t => t.priority === 'High').length;
                const medCount = ownerTasks.filter(t => t.priority === 'Medium').length;
                const lowCount = ownerTasks.filter(t => t.priority === 'Low').length;
                const card = document.createElement('div');
                card.className = 'bg-slate-700/40 p-5 rounded-xl border border-slate-600 hover:border-purple-500/50 transition-all';
                card.innerHTML = `
                    <div class="flex items-center gap-3 mb-4">
                        <div class="bg-purple-500/20 p-3 rounded-lg">
                            <i class="fa-solid fa-user text-purple-400 text-xl"></i>
                            <h4 class="font-bold text-white text-lg">${owner}</h4>
                            <p class="text-slate-400 text-sm">${taskCount} ${taskCount === 1 ? 'Task' : 'Tasks'}</p>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        ${highCount > 0 ? `<div class="flex items-center justify-between text-sm">
                            <span class="text-red-400 flex items-center gap-1">
                                <i class="fa-solid fa-flag"></i> High Priority
                            </span>
                            <span class="bg-red-500/20 text-red-400 px-2 py-0.5 rounded font-bold">${highCount}</span>
                        </div>` : ''}
                        ${medCount > 0 ? `<div class="flex items-center justify-between text-sm">
                            <span class="text-blue-400 flex items-center gap-1">
                                <i class="fa-solid fa-flag"></i> Medium Priority
                            </span>
                            <span class="bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded font-bold">${medCount}</span>
                        </div>` : ''}
                        ${lowCount > 0 ? `<div class="flex items-center justify-between text-sm">
                            <span class="text-green-400 flex items-center gap-1">
                                <i class="fa-solid fa-flag"></i> Low Priority
                            </span>
                            <span class="bg-green-500/20 text-green-400 px-2 py-0.5 rounded font-bold">${lowCount}</span>
                        </div>` : ''}
                    </div>
                `;
                distributionContainer.appendChild(card);
            });
        }
//Edit task
        function addTask() {
            addTaskCard("Click to edit this task...", "Me", "Medium");
        }
// PDF
        function exportToPDF() {
            const element = document.getElementById('reportContent');
            const opt = {
                margin:1,
                filename:'ThinkTank_Meeting_Report.pdf',
                image:{ type: 'jpeg', quality: 0.98 },
                html2canvas:{ scale: 2 },
                jsPDF:{ unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }
    </script>

    <style>
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        [contenteditable]:empty:before {
            content: attr(placeholder);
            color: #555;
            display: block;
        }
    </style>
</body>
</html>